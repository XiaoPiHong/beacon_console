import{j as M,c as pe,a as he,b as _e,d as ge,_ as fe,m as $,e as P,i as B,f as ye,r as m,C as be,u as T,s as x,g as ve,h as k,k as A,M as Pe,l as z,T as K,$ as Ie,n as Ee,N as Oe,I as Re,U as G,L as H,o as J,B as W,p as Se,q as Z,F as Q,S as Te,t as j,v as xe,O as we,w as Ne,P as Ce,x as Le}from"./vendor-13d319d9.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const Me=M.Fragment,s=M.jsx,f=M.jsxs;var g=(e=>(e.LOGIN="LOGIN",e.SET_USERINFO="SET_USERINFO",e.SET_PERMISSION="SET_PERMISSION",e))(g||{});const ke={userInfo:null,permission:[]},Ae=(e=ke,t)=>{const{type:n,payload:r}=t;switch(n){case g.LOGIN:return{...e,...r};case g.SET_USERINFO:return{...e,userInfo:r};case g.SET_PERMISSION:return{...e,permission:r};default:return e}},je=pe({user:Ae}),Ue=he(je,_e(ge(fe)));function $e(e,t){return $(P(e),t,(n,r)=>{if(B(n)&&B(r))return $(P(n),r,(o,i)=>ye(o)?o.concat(i):void 0)})}const X=e=>e.replace(/^\//,"").replace(/\/:[^/]+/g,""),N=getComputedStyle(document.documentElement),Be=e=>e.replace(/([A-Z])/g,"-$1").toLowerCase(),Fe={borderRadius:0},Y={token:{...Fe,colorPrimary:N.getPropertyValue("--color-primary"),menuColor:N.getPropertyValue("--menu-color"),menuHoverBg:N.getPropertyValue("--menu-hover-bg")}},Ve=m.createContext({theme:P(Y),updateTheme:()=>{}}),De=({children:e})=>{const[t,n]=m.useState(P(Y)),r=i=>{Object.keys(i).forEach(c=>{Object.prototype.toString.call(i[c])==="[object Object]"?r(i[c]):document.documentElement.style.setProperty(`--${Be(c)}`,i[c])})},o=(i={})=>{n(c=>({...$e(c,i)})),r(i)};return s(Ve.Provider,{value:{theme:t,updateTheme:o},children:s(be,{theme:t,children:e})})},qe="modulepreload",ze=function(e){return"/beacon_console/"+e},F={},h=function(t,n,r){if(!n||n.length===0)return t();const o=document.getElementsByTagName("link");return Promise.all(n.map(i=>{if(i=ze(i),i in F)return;F[i]=!0;const c=i.endsWith(".css"),a=c?'[rel="stylesheet"]':"";if(!!r)for(let p=o.length-1;p>=0;p--){const d=o[p];if(d.href===i&&(!c||d.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${a}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":qe,c||(u.as="script",u.crossOrigin=""),u.href=i,document.head.appendChild(u),c)return new Promise((p,d)=>{u.addEventListener("load",p),u.addEventListener("error",()=>d(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t())},O={"app-container":"_app-container_113qc_1","app-container__header":"_app-container__header_113qc_10","app-container__tabs":"_app-container__tabs_113qc_14","app-container__main":"_app-container__main_113qc_18"},R={"header-container":"_header-container_roc25_1","header-container-logo":"_header-container-logo_roc25_7","header-container-menu":"_header-container-menu_roc25_11","header-container-setting":"_header-container-setting_roc25_15"},Ke=(e,t,n)=>{const{idKey:r,parentIdKey:o,formatNode:i=a=>a}=n,c=(a,l)=>{const u=[];for(let p=0,d=l.length;p<d;p++){const _=l[p],y=_[o],v=_[r];if(y===a){const w={id:v,data:_,children:c(v,l)};u.push(i(w))}}return u};return c(e,t)},Ge=({data:e,children:t})=>({...e,children:t}),ee=(e,t=null,n)=>e.map(r=>{const o={...r,url:t?`${t.url+r.permissionCode}`:r.permissionCode};return o.children=ee(r.children,o,n),n?n(o):o});function te({formatNode:e,includeButton:t=!1,filterUnShowRoute:n=!0}){const{permission:r}=T(a=>({permission:a.user.permission}),x),o=a=>{let l=!0;return t||(l=l&&a.type==="ROUTE"),n&&(l=l&&a.show===!0),l},i=P(r.filter(a=>o(a)));return{menu:ee(Ke(null,i,{idKey:"permissionId",parentIdKey:"parentPermissionId",formatNode:a=>Ge(a)}),null,e)}}const ne=m.createContext({routes:[],routerMetas:[]}),He=({routerMetas:e,routes:t})=>{const n=ve(t);return s(ne.Provider,{value:{routerMetas:e,routes:t},children:n})},U=()=>m.useContext(ne),Je=()=>{const e=k(),t=A(),{routerMetas:n}=U(),{menu:r}=te({formatNode:({permissionId:c,url:a,permissionName:l,children:u})=>({key:a,label:l,url:a,children:u.length?u:void 0})}),o=()=>n.find(a=>z(a.url,t.pathname)),i=c=>{const{props:{url:a}}=c.item;e(a)};return s(Pe,{id:"menu",selectedKeys:[o().url],onSelect:i,mode:"horizontal",items:r})},We=()=>f("div",{className:R["header-container"],children:[s("div",{className:R["header-container-logo"]}),s("div",{className:R["header-container-menu"],children:s(Je,{})}),s("div",{className:R["header-container-setting"]})]}),Ze=({aliveRef:e})=>{const t=k(),n=Symbol("tab"),r=A(),{routerMetas:o}=U(),{permission:i}=T(d=>({permission:d.user.permission}),x);let c=`${n.description}/home`;const a=m.useRef(new Map([[`${n.description}/home`,{url:"/home",meta:{title:"首页",closable:!1},children:[]}]])),l=()=>{if(i.length){const d=o.find(y=>z(y.url,r.pathname)),_=`${n.description}${r.pathname}`;a.current.set(_,d),c=_}},u=d=>{t(d.split(`${n.description}`)[1])},p=(d,_)=>{var y;if(_==="remove"){a.current.delete(d),(y=e.current)==null||y.removeCache(d.split(`${n.description}`)[1]);const v=Array.from(a.current),w=v[v.length-1][0];t(w.split(`${n.description}`)[1])}};return l(),m.useEffect(()=>()=>{a.current.clear()},[]),s(K,{activeKey:c,type:"editable-card",hideAdd:!0,items:Array.from(a.current).map(d=>({key:d[0],label:d[1].meta.title,closable:d[1].meta.closable,children:null})),onChange:u,onEdit:p})},Qe=({children:e})=>e,C=()=>{console.log("layout");const{routes:e}=U(),{pathname:t}=A(),n=Ie(),[r,o]=m.useState(0),i=Ee();m.useEffect(()=>{o(r+1)},[e]);const c=m.useMemo(()=>r===0?1:r,[r]);return f("div",{className:O["app-container"],children:[s("div",{className:O["app-container__header"],children:s(We,{})}),s("div",{className:O["app-container__tabs"],children:s(Ze,{aliveRef:n})}),s("div",{className:O["app-container__main"],children:s(Qe,{children:s(Oe,{aliveRef:n,activeName:t,cache:!0,children:i},c)})})]})},re=()=>(console.log("渲染主页"),f("section",{children:[s(Re,{}),"主页"]})),Xe=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"})),Ye="_page_1x1ij_1",et="_login_1x1ij_6",tt="_login__header_1x1ij_10",nt="_login__body_1x1ij_22",b={page:Ye,login:et,login__header:tt,"login__header-title":"_login__header-title_1x1ij_13","login__header-description":"_login__header-description_1x1ij_17",login__body:nt},se=({methods:e,loading:t,onClickLoginBtn:n})=>({items:[{name:"username",label:"",component:"Input",required:!0,componentProps:{prefix:s(G,{}),placeholder:"用户名"}},{name:"password",label:"",component:"InputPassword",required:!0,componentProps:{prefix:s(H,{}),placeholder:"密码"}},{name:"remember",label:"",initialValue:!1,valuePropName:"checked",render:({model:r})=>f("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s(J,{checked:r.remember,onChange:o=>{e.setFieldsValue({remember:o.target.checked})},children:"记住账号"}),s(W,{type:"link",children:"忘记密码"})]})},{name:"submit",label:"",component:"Button",componentProps:{type:"primary",children:"登录",style:{width:"100%"},loading:t,onClick:n}}]}),oe=({methods:e,loading:t,onClickRegisterBtn:n})=>({items:[{name:"username",label:"",component:"Input",required:!0,componentProps:{prefix:s(G,{}),placeholder:"用户名"}},{name:"password",label:"",component:"InputPassword",required:!0,componentProps:{prefix:s(H,{}),placeholder:"密码"}},{name:"remember",label:"",initialValue:!1,valuePropName:"checked",render:({model:r})=>f("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s(J,{checked:r.remember,onChange:o=>{e.setFieldsValue({remember:o.target.checked})},children:"记住账号"}),s(W,{type:"link",children:"忘记密码"})]})},{name:"submit",label:"",component:"Button",componentProps:{type:"primary",children:"注册",style:{width:"100%"},loading:t,onClick:n}}]}),rt=Object.freeze(Object.defineProperty({__proto__:null,getLoginFormProps:se,getRegisterFormProps:oe},Symbol.toStringTag,{value:"Module"})),V=new Map([["JSON",{get:e=>JSON.parse(e),set:e=>JSON.stringify(e)}]]);function st(e){return function(t,n){return{get(){let r=e.getItem(t);if(typeof n<"u"){const o=V.get(n);o&&(r=o.get(r))}return r},set(r){if(typeof n<"u"){const o=V.get(n);o&&(r=o.set(r))}return e.setItem(t,r)},remove:()=>e.removeItem(t)}}}const D=st(localStorage),I={token:D("token"),user:D("user","JSON")},ie=[{permissionId:"1",permissionName:"首页",permissionCode:"/home",description:"string",type:"ROUTE",show:!0,parentPermissionId:null,closable:!1},{permissionId:"1-1",permissionName:"查看",permissionCode:"view",description:"string",type:"BUTTON",show:!0,parentPermissionId:"1",closable:!0},{permissionId:"2",permissionName:"系统",permissionCode:"/system",description:"string",type:"ROUTE",show:!0,parentPermissionId:null,closable:!0},{permissionId:"2-1",permissionName:"角色管理",permissionCode:"/role/:id/:name",description:"string",type:"ROUTE",show:!1,parentPermissionId:"2",closable:!0},{permissionId:"2-2",permissionName:"组织架构",permissionCode:"/organizationalStructure",description:"string",type:"ROUTE",show:!0,parentPermissionId:"2",closable:!0},{permissionId:"2-2-1",permissionName:"部门管理",permissionCode:"/department",description:"string",type:"ROUTE",show:!0,parentPermissionId:"2-2",closable:!0},{permissionId:"2-2-1-1",permissionName:"查看",permissionCode:"view",description:"string",type:"BUTTON",show:!0,parentPermissionId:"2-2-1",closable:!0},{permissionId:"2-1-1",permissionName:"查看",permissionCode:"view",description:"string",type:"BUTTON",show:!0,parentPermissionId:"2-1",closable:!0},{permissionId:"2-1-2",permissionName:"编辑",permissionCode:"edit",description:"string",type:"BUTTON",show:!0,parentPermissionId:"2-1",closable:!0},{permissionId:"3",permissionName:"用户",permissionCode:"/user",description:"string",type:"ROUTE",show:!0,parentPermissionId:null,closable:!0},{permissionId:"3-1",permissionName:"用户管理",permissionCode:"/userManage",description:"string",type:"ROUTE",show:!0,parentPermissionId:"3",closable:!0}],ot=()=>new Promise(e=>{setTimeout(()=>{e(!0)},300)}),q=()=>new Promise(e=>{setTimeout(()=>{e({data:{user:{name:"xxx",password:"xxx"},token:"token"}})},300)}),it=()=>new Promise(e=>{setTimeout(()=>{e({data:{user:{name:"xxx",password:"xxx"}}})},300)}),at=()=>new Promise(e=>{q().then(async()=>{const{data:t}=await q();console.log(t),I.token.set(t.token),I.user.set(t.user),e({type:g.LOGIN,payload:{userInfo:t.user,permission:ie}})})}),ct=async()=>{const{data:e}=await it();return console.log(e),I.user.set(e.user),{type:g.SET_USERINFO,payload:e.user}},lt=async()=>{const e=await ot();return console.log(e),{type:g.SET_PERMISSION,payload:ie}},ut=e=>{const t=k(),[n,r]=m.useState(!1),o=()=>{c.validator().then(u=>{console.log(u),r(!0),e.login().then(()=>{t("/home")}).finally(()=>{r(!1)})})};console.log("=======================================parent render");const[i,c]=Z(),a=se({methods:c,loading:n,onClickLoginBtn:o}),l=m.useRef();return s(Q,{register:i,ref:l,...a})},ae=Se(e=>({user:e.user}),{login:at})(ut),dt=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"}));function ce(){const[e,t]=m.useState(!1),[n,r]=Z(),i=oe({methods:r,loading:e,onClickRegisterBtn:()=>{t(!0),t(!1)}});return s(Q,{register:n,...i})}const mt=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));function le(){let e="1";return{tabsActiveKey:e,tabsList:[{key:"1",label:"登录",children:s(ae,{})},{key:"2",label:"注册",children:s(ce,{})}],onChangeTabs:r=>{e=r}}}const pt=Object.freeze(Object.defineProperty({__proto__:null,default:le},Symbol.toStringTag,{value:"Module"})),ue=()=>{const{tabsActiveKey:e,tabsList:t,onChangeTabs:n}=le();return s("div",{className:b.page,children:f("div",{className:b.login,children:[f("div",{className:b.login__header,children:[s("div",{className:b["login__header-title"],children:"项目管理系统"}),s("div",{className:b["login__header-description"],children:"项目成功，系统成就"})]}),s("div",{className:b.login__body,children:s(K,{defaultActiveKey:e,items:t,onChange:n})})]})})},ht=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"})),_t={"loading-container":"_loading-container_u84nk_1"},de=()=>s("div",{className:_t["loading-container"],children:s(Te,{tip:"玩命加载中",children:s(Me,{})})}),gt=Object.assign({"../views/error/index.tsx":()=>h(()=>import("./index-9ee749b5.js"),["assets/index-9ee749b5.js","assets/vendor-13d319d9.js","assets/vendor-c2f31cdc.css"]),"../views/home/index.tsx":()=>h(()=>Promise.resolve().then(()=>Xe),void 0),"../views/login/components/signin-form.tsx":()=>h(()=>Promise.resolve().then(()=>dt),void 0),"../views/login/components/signup-form.tsx":()=>h(()=>Promise.resolve().then(()=>mt),void 0),"../views/login/hooks/use-tags.tsx":()=>h(()=>Promise.resolve().then(()=>pt),void 0),"../views/login/index.tsx":()=>h(()=>Promise.resolve().then(()=>ht),void 0),"../views/login/indexConfig.tsx":()=>h(()=>Promise.resolve().then(()=>rt),void 0),"../views/system/organizationalStructure/department/index.tsx":()=>h(()=>import("./index-879e024a.js"),["assets/index-879e024a.js","assets/vendor-13d319d9.js","assets/vendor-c2f31cdc.css"]),"../views/system/role/index.tsx":()=>h(()=>import("./index-37d0e112.js"),["assets/index-37d0e112.js","assets/vendor-13d319d9.js","assets/vendor-c2f31cdc.css"]),"../views/user/userManage/index.tsx":()=>h(()=>import("./index-2e3678f5.js"),["assets/index-2e3678f5.js","assets/vendor-13d319d9.js","assets/vendor-c2f31cdc.css"])}),E=(e,t)=>{const n=m.lazy(gt[`../views/${e}/index.tsx`]);return s(m.Suspense,{fallback:s(de,{}),children:s(n,{...t})})},S=({children:e})=>{const t=I.token.get(),{userInfo:n}=T(i=>({userInfo:i.user.userInfo}),x),r=xe(),o=m.lazy(async()=>(t&&!n&&await Promise.all([ct(),lt()]).then(([i,c])=>{r(i),r(c)}).catch(()=>({default:()=>E("error",{type:500})})),{default:t?()=>e:()=>s(j,{to:"/login"})}));return s(m.Suspense,{fallback:s(de,{}),children:s(o,{})})},ft=()=>[{path:"/login",element:I.token.get()?s(j,{replace:!0,to:"/home"}):s(ue,{})}],yt=e=>[{path:"/",element:s(j,{to:"/home"})},...e,{path:"/home",element:s(C,{}),children:[{path:"",element:s(S,{children:s(re,{})}),meta:{title:"首页",closable:!1}}]},{path:"*",element:s(C,{}),children:[{path:"*",element:s(S,{children:E("error",{type:404})}),meta:{title:"错误页",closable:!0}}]}],me=({children:e,url:t,id:n})=>{const{permission:r}=T(a=>({permission:a.user.permission}),x),o=r.find(a=>a.permissionId===n);return r.filter(a=>a.parentPermissionId===(o==null?void 0:o.permissionId)&&a.type==="BUTTON").findIndex(a=>a.permissionCode==="view")!==-1?e:E("error",{type:403})},bt=(e,t)=>{switch(!!e){case!0:return t.permissionCode.replace(/^\//,"");case!1:return t.permissionCode}},vt=(e,t)=>{const n=!!e,{url:r}=t;switch(n){case!0:return t.children.length?s(we,{}):s(S,{children:s(me,{url:r,id:t.permissionId,children:E(X(r))})});case!1:return s(C,{})}},Pt=(e,t)=>{const n=!!e,{url:r}=t;switch(n){case!0:return L(t.children,t);case!1:return t.children.length?L(t.children,t):[{path:"",element:s(S,{children:s(me,{url:r,id:t.permissionId,children:E(X(r))})}),meta:{title:t.permissionName,closable:t.closable}}]}},L=(e,t=null)=>e.map(n=>(n.url=((t==null?void 0:t.url)||"")+n.permissionCode,{path:bt(t,n),element:vt(t,n),children:Pt(t,n),meta:{title:n.permissionName,closable:n.closable}}));function It(){const{menu:e}=te({filterUnShowRoute:!1}),t=L(e),n=[...ft(),...yt(t)],r=(c,a=null)=>c.map(l=>{if(l.path.includes("*"))return{url:l.children[0].path,children:[],meta:l.children[0].meta||{}};const u=a?`${a.path+(l.path?"/"+l.path:"")}`:l.path,p=r(l.children||[],{...l,path:u});return{url:u,children:p,meta:l.meta||{}}}),o=c=>{const a=[];return c.forEach(l=>{l.children&&l.children.length?a.push(...o(l.children)):a.push({meta:l.meta,url:l.url,children:[]})}),a},i=o(r(n));return{routes:n,routerMetas:i}}const Et=()=>{const{routes:e,routerMetas:t}=It();return s(He,{routerMetas:t,routes:e})},{VITE_ROUTER_BASENAME:Ot}={VITE_BASE_API_URL:"",VITE_BASE:"/beacon_console/",VITE_ROUTER_BASENAME:"/beacon_console",BASE_URL:"/beacon_console/",MODE:"gh-pages",DEV:!1,PROD:!0,SSR:!1};Ne.createRoot(document.getElementById("root")).render(s(De,{children:s(Ce,{store:Ue,children:s(Le,{basename:Ot,children:s(Et,{})})})}));export{f as a,s as j};
