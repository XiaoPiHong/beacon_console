import{j as R,c as me,a as pe,b as he,d as ge,_ as _e,m as k,e as b,i as j,f as fe,r as c,C as ye,u as E,s as N,g as B,h as V,M as be,k as Pe,l as ve,n as Ie,T as $,O as D,U as q,L as z,o as K,B as G,p as H,F as J,S as Oe,N as C,q as Se,t as we,v as xe,P as Te,w as Re}from"./vendor-b8cfd248.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(s){if(s.ep)return;s.ep=!0;const i=r(s);fetch(s.href,i)}})();const Ee=R.Fragment,n=R.jsx,f=R.jsxs;var h=(e=>(e.LOGIN="LOGIN",e.SET_USERINFO="SET_USERINFO",e.SET_PERMISSION="SET_PERMISSION",e))(h||{});const Ne={userInfo:null,permission:[]},Ce=(e=Ne,t)=>{const{type:r,payload:o}=t;switch(r){case h.LOGIN:return{...e,...o};case h.SET_USERINFO:return{...e,userInfo:o};case h.SET_PERMISSION:return{...e,permission:o};default:return e}},Le=me({user:Ce}),ke=pe(Le,he(ge(_e)));function je(e,t){return k(b(e),t,(r,o)=>{if(j(r)&&j(o))return k(b(r),o,(s,i)=>fe(s)?s.concat(i):void 0)})}const W=e=>e.replace(/^\//,"").replace(/\/:[^/]+/g,""),x=getComputedStyle(document.documentElement),Me=e=>e.replace(/([A-Z])/g,"-$1").toLowerCase(),Ue={borderRadius:0},Z={token:{...Ue,colorPrimary:x.getPropertyValue("--color-primary"),menuColor:x.getPropertyValue("--menu-color"),menuHoverBg:x.getPropertyValue("--menu-hover-bg")}},Fe=c.createContext({theme:b(Z),updateTheme:()=>{}}),Ae=({children:e})=>{const[t,r]=c.useState(b(Z)),o=i=>{Object.keys(i).forEach(a=>{Object.prototype.toString.call(i[a])==="[object Object]"?o(i[a]):document.documentElement.style.setProperty(`--${Me(a)}`,i[a])})},s=(i={})=>{r(a=>({...je(a,i)})),o(i)};return n(Fe.Provider,{value:{theme:t,updateTheme:s},children:n(ye,{theme:t,children:e})})},Be="modulepreload",Ve=function(e){return"/"+e},M={},m=function(t,r,o){if(!r||r.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(r.map(i=>{if(i=Ve(i),i in M)return;M[i]=!0;const a=i.endsWith(".css"),l=a?'[rel="stylesheet"]':"";if(!!o)for(let p=s.length-1;p>=0;p--){const g=s[p];if(g.href===i&&(!a||g.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${i}"]${l}`))return;const d=document.createElement("link");if(d.rel=a?"stylesheet":Be,a||(d.as="script",d.crossOrigin=""),d.href=i,document.head.appendChild(d),a)return new Promise((p,g)=>{d.addEventListener("load",p),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${i}`)))})})).then(()=>t())},I={"app-container":"_app-container_113qc_1","app-container__header":"_app-container__header_113qc_10","app-container__tabs":"_app-container__tabs_113qc_14","app-container__main":"_app-container__main_113qc_18"},O={"header-container":"_header-container_roc25_1","header-container-logo":"_header-container-logo_roc25_7","header-container-menu":"_header-container-menu_roc25_11","header-container-setting":"_header-container-setting_roc25_15"},$e=(e,t,r)=>{const{idKey:o,parentIdKey:s,formatNode:i=l=>l}=r,a=(l,u)=>{const d=[];for(let p=0,g=u.length;p<g;p++){const w=u[p],ue=w[s],L=w[o];if(ue===l){const de={id:L,data:w,children:a(L,u)};d.push(i(de))}}return d};return a(e,t)},De=({data:e,children:t})=>({...e,children:t}),Q=(e,t=null,r)=>e.map(o=>{const s={...o,url:t?`${t.url+o.permissionCode}`:o.permissionCode};return s.children=Q(o.children,s,r),r?r(s):s});function X({formatNode:e,includeButton:t=!1,filterUnShowRoute:r=!0}){const{permission:o}=E(l=>({permission:l.user.permission}),N),s=l=>{let u=!0;return t||(u=u&&l.type==="ROUTE"),r&&(u=u&&l.show===!0),u},i=b(o.filter(l=>s(l)));return{menu:Q($e(null,i,{idKey:"permissionId",parentIdKey:"parentPermissionId",formatNode:l=>De(l)}),null,e)}}const qe=({permission:e})=>{const t=V(),{menu:r}=X({formatNode:({permissionId:s,url:i,permissionName:a,children:l})=>({key:s,label:a,url:i,children:l.length?l:void 0})});return n(be,{id:"menu",onSelect:s=>{const{props:{url:i}}=s.item;t(i)},mode:"horizontal",items:r})},ze=B(e=>({permission:e.user.permission}))(qe),Ke=()=>f("div",{className:O["header-container"],children:[n("div",{className:O["header-container-logo"]}),n("div",{className:O["header-container-menu"],children:n(ze,{})}),n("div",{className:O["header-container-setting"]})]}),Y=c.createContext({routes:[]}),Ge=({children:e,routes:t})=>n(Y.Provider,{value:{routes:t},children:e}),He=()=>c.useContext(Y),Je=()=>{const e=Pe(),{routes:t}=He(),r=c.useRef(new Map),o=s=>s.map(i=>i.children&&i.children.length?o(i.children):i);return console.log(o(t).flat(1/0).map(s=>({path:s.path,meta:s.meta}))),console.log(e.pathname),console.log(ve("/system/role/:id/:name",e.pathname)),console.log(Ie(e.pathname)),c.useEffect(()=>()=>{console.log("销毁"),r.current.clear()},[]),n($,{type:"card"})},We=({children:e})=>e,S=()=>f("div",{className:I["app-container"],children:[n("div",{className:I["app-container__header"],children:n(Ke,{})}),n("div",{className:I["app-container__tabs"],children:n(Je,{})}),n("div",{className:I["app-container__main"],children:n(We,{children:n(D,{})})})]}),ee=()=>n("section",{children:"主页"}),Ze=Object.freeze(Object.defineProperty({__proto__:null,default:ee},Symbol.toStringTag,{value:"Module"})),Qe="_page_1x1ij_1",Xe="_login_1x1ij_6",Ye="_login__header_1x1ij_10",et="_login__body_1x1ij_22",_={page:Qe,login:Xe,login__header:Ye,"login__header-title":"_login__header-title_1x1ij_13","login__header-description":"_login__header-description_1x1ij_17",login__body:et},te=({methods:e,loading:t,onClickLoginBtn:r})=>({items:[{name:"username",label:"",component:"Input",required:!0,componentProps:{prefix:n(q,{}),placeholder:"用户名"}},{name:"password",label:"",component:"InputPassword",required:!0,componentProps:{prefix:n(z,{}),placeholder:"密码"}},{name:"remember",label:"",initialValue:!1,valuePropName:"checked",render:({model:o})=>f("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n(K,{checked:o.remember,onChange:s=>{e.setFieldsValue({remember:s.target.checked})},children:"记住账号"}),n(G,{type:"link",children:"忘记密码"})]})},{name:"submit",label:"",component:"Button",componentProps:{type:"primary",children:"登录",style:{width:"100%"},loading:t,onClick:r}}]}),ne=({methods:e,loading:t,onClickRegisterBtn:r})=>({items:[{name:"username",label:"",component:"Input",required:!0,componentProps:{prefix:n(q,{}),placeholder:"用户名"}},{name:"password",label:"",component:"InputPassword",required:!0,componentProps:{prefix:n(z,{}),placeholder:"密码"}},{name:"remember",label:"",initialValue:!1,valuePropName:"checked",render:({model:o})=>f("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[n(K,{checked:o.remember,onChange:s=>{e.setFieldsValue({remember:s.target.checked})},children:"记住账号"}),n(G,{type:"link",children:"忘记密码"})]})},{name:"submit",label:"",component:"Button",componentProps:{type:"primary",children:"注册",style:{width:"100%"},loading:t,onClick:r}}]}),tt=Object.freeze(Object.defineProperty({__proto__:null,getLoginFormProps:te,getRegisterFormProps:ne},Symbol.toStringTag,{value:"Module"})),U=new Map([["JSON",{get:e=>JSON.parse(e),set:e=>JSON.stringify(e)}]]);function nt(e){return function(t,r){return{get(){let o=e.getItem(t);if(typeof r<"u"){const s=U.get(r);s&&(o=s.get(o))}return o},set(o){if(typeof r<"u"){const s=U.get(r);s&&(o=s.set(o))}return e.setItem(t,o)},remove:()=>e.removeItem(t)}}}const F=nt(localStorage),P={token:F("token"),user:F("user","JSON")},re=[{permissionId:"1",permissionName:"首页",permissionCode:"/home",description:"string",type:"ROUTE",show:!0,parentPermissionId:null,closable:!1},{permissionId:"1-1",permissionName:"查看",permissionCode:"view",description:"string",type:"BUTTON",show:!0,parentPermissionId:"1",closable:!0},{permissionId:"2",permissionName:"系统",permissionCode:"/system",description:"string",type:"ROUTE",show:!0,parentPermissionId:null,closable:!0},{permissionId:"2-1",permissionName:"角色管理",permissionCode:"/role/:id/:name",description:"string",type:"ROUTE",show:!1,parentPermissionId:"2",closable:!0},{permissionId:"2-2",permissionName:"组织架构",permissionCode:"/organizationalStructure",description:"string",type:"ROUTE",show:!0,parentPermissionId:"2",closable:!0},{permissionId:"2-2-1",permissionName:"部门管理",permissionCode:"/department",description:"string",type:"ROUTE",show:!0,parentPermissionId:"2-2",closable:!0},{permissionId:"2-2-1-1",permissionName:"查看",permissionCode:"view",description:"string",type:"BUTTON",show:!0,parentPermissionId:"2-2-1",closable:!0},{permissionId:"2-1-1",permissionName:"查看",permissionCode:"view",description:"string",type:"BUTTON",show:!0,parentPermissionId:"2-1",closable:!0},{permissionId:"2-1-2",permissionName:"编辑",permissionCode:"edit",description:"string",type:"BUTTON",show:!0,parentPermissionId:"2-1",closable:!0},{permissionId:"3",permissionName:"用户",permissionCode:"/user",description:"string",type:"ROUTE",show:!0,parentPermissionId:null,closable:!0},{permissionId:"3-1",permissionName:"用户管理",permissionCode:"/userManage",description:"string",type:"ROUTE",show:!0,parentPermissionId:"3",closable:!0}],rt=()=>new Promise(e=>{setTimeout(()=>{e(!0)},300)}),A=()=>new Promise(e=>{setTimeout(()=>{e({data:{user:{name:"xxx",password:"xxx"},token:"token"}})},300)}),st=()=>new Promise(e=>{setTimeout(()=>{e({data:{user:{name:"xxx",password:"xxx"}}})},300)}),ot=()=>new Promise(e=>{A().then(async()=>{const{data:t}=await A();console.log(t),P.token.set(t.token),P.user.set(t.user),e({type:h.LOGIN,payload:{userInfo:t.user,permission:re}})})}),it=async()=>{const{data:e}=await st();return console.log(e),P.user.set(e.user),{type:h.SET_USERINFO,payload:e.user}},at=async()=>{const e=await rt();return console.log(e),{type:h.SET_PERMISSION,payload:re}},lt=e=>{const t=V(),[r,o]=c.useState(!1),s=()=>{a.validator().then(d=>{console.log(d),o(!0),e.login().then(()=>{t("/home")}).finally(()=>{o(!1)})})};console.log("=======================================parent render");const[i,a]=H(),l=te({methods:a,loading:r,onClickLoginBtn:s}),u=c.useRef();return n(J,{register:i,ref:u,...l})},se=B(e=>({user:e.user}),{login:ot})(lt),ct=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"}));function oe(){const[e,t]=c.useState(!1),[r,o]=H(),i=ne({methods:o,loading:e,onClickRegisterBtn:()=>{t(!0),t(!1)}});return n(J,{register:r,...i})}const ut=Object.freeze(Object.defineProperty({__proto__:null,default:oe},Symbol.toStringTag,{value:"Module"}));function ie(){let e="1";return{tabsActiveKey:e,tabsList:[{key:"1",label:"登录",children:n(se,{})},{key:"2",label:"注册",children:n(oe,{})}],onChangeTabs:o=>{e=o}}}const dt=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"})),ae=()=>{const{tabsActiveKey:e,tabsList:t,onChangeTabs:r}=ie();return n("div",{className:_.page,children:f("div",{className:_.login,children:[f("div",{className:_.login__header,children:[n("div",{className:_["login__header-title"],children:"项目管理系统"}),n("div",{className:_["login__header-description"],children:"项目成功，系统成就"})]}),n("div",{className:_.login__body,children:n($,{defaultActiveKey:e,items:t,onChange:r})})]})})},mt=Object.freeze(Object.defineProperty({__proto__:null,default:ae},Symbol.toStringTag,{value:"Module"})),pt={"loading-container":"_loading-container_u84nk_1"},le=()=>n("div",{className:pt["loading-container"],children:n(Oe,{tip:"玩命加载中",children:n(Ee,{})})}),ht=Object.assign({"../views/error/index.tsx":()=>m(()=>import("./index-b96806f4.js"),["assets/index-b96806f4.js","assets/vendor-b8cfd248.js","assets/vendor-c2f31cdc.css"]),"../views/home/index.tsx":()=>m(()=>Promise.resolve().then(()=>Ze),void 0),"../views/login/components/signin-form.tsx":()=>m(()=>Promise.resolve().then(()=>ct),void 0),"../views/login/components/signup-form.tsx":()=>m(()=>Promise.resolve().then(()=>ut),void 0),"../views/login/hooks/use-tags.tsx":()=>m(()=>Promise.resolve().then(()=>dt),void 0),"../views/login/index.tsx":()=>m(()=>Promise.resolve().then(()=>mt),void 0),"../views/login/indexConfig.tsx":()=>m(()=>Promise.resolve().then(()=>tt),void 0),"../views/system/organizationalStructure/department/index.tsx":()=>m(()=>import("./index-021716af.js"),["assets/index-021716af.js","assets/vendor-b8cfd248.js","assets/vendor-c2f31cdc.css"]),"../views/system/role/index.tsx":()=>m(()=>import("./index-925c47e0.js"),["assets/index-925c47e0.js","assets/vendor-b8cfd248.js","assets/vendor-c2f31cdc.css"]),"../views/user/userManage/index.tsx":()=>m(()=>import("./index-3e20610a.js"),["assets/index-3e20610a.js","assets/vendor-b8cfd248.js","assets/vendor-c2f31cdc.css"])}),y=(e,t)=>{const r=c.lazy(ht[`../views/${e}/index.tsx`]);return n(c.Suspense,{fallback:n(le,{}),children:n(r,{...t})})},v=({children:e})=>{const t=P.token.get(),{userInfo:r}=E(i=>({userInfo:i.user.userInfo}),N),o=Se(),s=c.lazy(async()=>(t&&!r&&await Promise.all([it(),at()]).then(([i,a])=>{o(i),o(a)}).catch(()=>({default:()=>y("error",{type:500})})),{default:t?()=>e:()=>n(C,{to:"/login"})}));return n(c.Suspense,{fallback:n(le,{}),children:n(s,{})})},gt=()=>[{path:"/login",element:P.token.get()?n(C,{replace:!0,to:"/home"}):n(ae,{})},{path:"/user",element:n(S,{}),children:[{path:"userManage",element:n(v,{children:y("user/userManage")}),meta:{title:"用户管理",closable:!0}}]}],_t=e=>[{path:"/",element:n(C,{to:"/home"})},...e,{path:"/home",element:n(S,{}),children:[{path:"",element:n(v,{children:n(ee,{})}),meta:{title:"首页",closable:!1}}]},{path:"*",element:n(S,{}),children:[{path:"*",element:n(v,{children:y("error",{type:404})}),meta:{title:"错误页",closable:!0}}]}],ce=({children:e,url:t,id:r})=>{const{permission:o}=E(l=>({permission:l.user.permission}),N),s=o.find(l=>l.permissionId===r);return o.filter(l=>l.parentPermissionId===(s==null?void 0:s.permissionId)&&l.type==="BUTTON").findIndex(l=>l.permissionCode==="view")!==-1?e:y("error",{type:403})},ft=(e,t)=>{switch(!!e){case!0:return t.permissionCode.replace(/^\//,"");case!1:return t.permissionCode}},yt=(e,t)=>{const r=!!e,{url:o}=t;switch(r){case!0:return t.children.length?n(D,{}):n(v,{children:n(ce,{url:o,id:t.permissionId,children:y(W(o))})});case!1:return n(S,{})}},bt=(e,t)=>{const r=!!e,{url:o}=t;switch(r){case!0:return T(t.children,t);case!1:return t.children.length?T(t.children,t):[{path:"",element:n(v,{children:n(ce,{url:o,id:t.permissionId,children:y(W(o))})}),meta:{title:t.permissionName}}]}},T=(e,t=null)=>e.map(r=>(r.url=((t==null?void 0:t.url)||"")+r.permissionCode,{path:ft(t,r),element:yt(t,r),children:bt(t,r),meta:{title:r.permissionName,url:r.url}}));function Pt(){const{menu:e}=X({filterUnShowRoute:!1}),t=T(e),r=[...gt(),..._t(t)];return console.log(r),{routes:r}}const vt=()=>{const{routes:e}=Pt(),t=we(e);return n(Ge,{routes:e,children:t})};xe.createRoot(document.getElementById("root")).render(n(Ae,{children:n(Te,{store:ke,children:n(Re,{children:n(vt,{})})})}));export{f as a,n as j};
